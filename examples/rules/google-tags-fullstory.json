{
  "rules": [
    {
      "id": "fs-ga-page-type",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$[?(pageType, pageName)]" },
        { "name": "insert", "value": "pageview" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-action",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce" },
        { "name": "flatten" },
        { "name": "query", "select": "$[?(action)]" },
        { "name": "query", "select": "$[!(products,impressions,promotions)]" },
        { "name": "convert", "properties": "revenue,tax,shipping", "type": "real" },
        { "name": "convert", "properties": "step", "type": "int" },
        { "name": "insert", "select": "action" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-product-detail",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.detail.products" },
        { "name": "fan-out" },
        { "name": "convert", "properties": "price", "type": "real" },
        { "name": "convert", "properties": "quantity,position", "type": "int" },
        { "name": "insert", "value": "product_detail" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-product-click",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.click.products" },
        { "name": "fan-out" },
        { "name": "convert", "properties": "price", "type": "real" },
        { "name": "convert", "properties": "quantity,position", "type": "int" },
        { "name": "insert", "value": "product_click" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-cart-add",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.add.products" },
        { "name": "fan-out" },
        { "name": "convert", "properties": "price", "type": "real" },
        { "name": "convert", "properties": "quantity,position", "type": "int" },
        { "name": "insert", "value": "product_add" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-cart-remove",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.remove.products" },
        { "name": "fan-out" },
        { "name": "convert", "properties": "price", "type": "real" },
        { "name": "convert", "properties": "quantity,position", "type": "int" },
        { "name": "insert", "value": "product_remove" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-promotion-clicks",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.promoClick.promotions" },
        { "name": "fan-out" },
        { "name": "insert", "value": "promotion_click" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-checkout",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.checkout.products" },
        { "name": "fan-out" },
        { "name": "convert", "properties": "price", "type": "real" },
        { "name": "convert", "properties": "quantity,position", "type": "int" },
        { "name": "insert", "value": "product_checkout" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-purchase",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.purchase.products" },
        { "name": "fan-out" },
        { "name": "convert", "properties": "price", "type": "real" },
        { "name": "convert", "properties": "quantity,position", "type": "int" },
        { "name": "insert", "value": "product_purchase" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-refund",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.refund.products" },
        { "name": "fan-out" },
        { "name": "convert", "properties": "price", "type": "real" },
        { "name": "convert", "properties": "quantity,position", "type": "int" },
        { "name": "insert", "value": "product_refund" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-user-vars",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$[?(userProfile)]" },
        { "name": "flatten"},
        { "name": "query", "select": "$[?(userId!=-1)]" },
        { "name": "insert", "select": "userId" }
      ],
      "destination": "FS.setUserVars",
      "readOnLoad": true,
      "monitor": true
    }
  ]
}