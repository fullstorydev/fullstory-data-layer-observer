<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Data Layer Observer Example: Google Tags</title>
    <meta charset="utf-8" />
    <script>
      window.dataLayer = [
        {
          "pageType": "Home",
          "pageName": "Home: Fruit shoppe"
        },
        {
          "gtm.start": 1598892794094,
          "event": "gtm.js",
          "gtm.uniqueEventId": 1
        },
        {
          "userProfile": {
            "userId": "101",
            "userType": "member",
            "loyaltyProgram": "early-adopter",
            "hashedEmail": "555-12232-2332232-232332"
          }
        },
        {
          "ecommerce": {
            "impressions": [
              {
                "name": "Heritage Huckleberries",
                "id": "P000525722",
                "price": "2.99",
                "category": "homepage product recs",
                "variant": "",
                "list": "homepage product recs",
                "position": 1,
                "dimension3": 4.7
              },
              {
                "name": "Classic Corn",
                "id": "P000614444",
                "price": "4.00",
                "category": "homepage product recs",
                "variant": "",
                "list": "homepage product recs",
                "position": 2,
                "dimension3": 5
              },
            ]
          },
          "gtm.uniqueEventId": 28
        },
        {
          "event": "productClick",
          "ecommerce": {
            "click": {
              "actionField": {"list": "Search Results"},
              "products": [
                {
                  "name": "Heritage Huckleberries",
                  "id": "P000525722",
                  "price": "2.99",
                  "brand": "Heritage",
                  "category": "homepage product recs",
                  "variant": "",
                  "position": 1
                }
              ]
            }
          },
          "eventCallback": function() {
            console.log("Callback called");
          }
        },
        {
          "ecommerce": {
            "detail": {
              "actionField": {"list": "Product Gallery"},
              "products": [
                {
                  "name": "Heritage Huckleberries",
                  "id": "P000525722",
                  "price": "2.99",
                  "brand": "Heritage",
                  "category": "product gallery",
                  "variant": ""
                }
              ]
            }
          }
        },
        {
          "event": "addToCart",
          "ecommerce": {
            "currencyCode": "USD",
            "add": {
              "products": [
                {
                  "name": "Heritage Huckleberries",
                  "id": "P000525722",
                  "price": "2.99",
                  "brand": "Heritage",
                  "category": "product",
                  "variant": "",
                  "quantity": 2
                }
              ]
            }
          }
        },
        {
          "event": "removeFromCart",
          "ecommerce": {
            "currencyCode": "USD",
            "remove": {
              "products": [
                {
                  "name": "Heritage Huckleberries",
                  "id": "P000525722",
                  "price": "2.99",
                  "brand": "Heritage",
                  "category": "product",
                  "variant": "",
                  "quantity": 1
                }
              ]
            }
          }
        },
        {
          "ecommerce": {
            "promoView": {
              "promotions": [
                {
                  "id": "1004-Blueberries123321",
                  "name": "Fruits",
                  "creative": "Blueberries123321",
                  "position": "Feature"
                },
                {
                  "id": "1001-Strawberries222333",
                  "name": "Fruits",
                  "creative": "Strawberries222333",
                  "position": "Sub1"
                }
              ]
            }
          },
          "gtm.uniqueEventId": 6
        },
        {
          "event": "promotionClick",
          "ecommerce": {
            "promoClick": {
              "promotions": [
                {
                  "id": "1004-Blueberries123321",
                  "name": "Fruits",
                  "creative": "Blueberries123321",
                  "position": "Feature"
                }
              ]
            }
          },
          "eventCallback": function() {
            console.log("Callback called");
          },
          "gtm.uniqueEventId": 6
        },
        {
          "event": "checkout",
          "ecommerce": {
            "checkout": {
              "actionField": {
                "step": 1,
                "option": "Visa"
              },
              "products": [
                {
                  "name": "Heritage Huckleberries",
                  "id": "P000525722",
                  "price": "2.99",
                  "brand": "Heritage",
                  "category": "fruit",
                  "variant": "",
                  "quantity": 1
                }
              ]
            }
          },
          "eventCallback": function() {
            console.log("Callback called");
          }
        },
        {
          "ecommerce": {
            "purchase": {
              "actionField": {
                "id": "T12345",
                "affiliation": "Online Store",
                "revenue": "35.43",
                "tax":"4.90",
                "shipping": "5.99",
                "coupon": ""
              },
              "products": [
                {
                  "name": "Heritage Huckleberries",
                  "id": "P000525722",
                  "price": "2.99",
                  "brand": "Heritage",
                  "category": "fruit",
                  "variant": "",
                  "quantity": 1,
                  "coupon": ""
                }
              ]
            }
          }
        },
        {
          "ecommerce": {
            "refund": {
              "actionField": {
                "id": "T12345"
              },
              "products": [
                {
                  "id": "P000525722",
                  "quantity": 1
                }
              ]
            }
          }
        },
        {
          "event": "gtm.dom",
          "gtm.uniqueEventId": 12
        },
        {
          "event": "Social-media Loaded",
          "gtm.uniqueEventId": 27
        },
        {
          "event": "gtm.load",
          "gtm.uniqueEventId": 42
        },
        {
          "event": "gtm.click",
          "gtm.element": {},
          "gtm.elementClasses": "x-icon",
          "gtm.elementId": "",
          "gtm.elementTarget": "",
          "gtm.elementUrl": "",
          "gtm.uniqueEventId": 45
        }
      ];
    </script>
  </head>
  <body>
    <h1>Data Layer Observer Example: Google Tags</h1>

    <p>
      Take a look at the source code of this page to see the DLO rules.
    </p>
    <p>
      The Javascript console will show the output of the rules.
    </p>

    <script>
      /*
        Look at the "basic-embed" example for more configuration options
      */
      window["_dlo_previewMode"] = true;
      window["_dlo_validateRules"] = true;

      window["_dlo_rules"] = [
    {
      "id": "fs-ga-page-type",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$[?(pageType, pageName)]" },
        { "name": "insert", "value": "View Page Type" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-impressions",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.impressions" },
        { "name": "fan-out" },
        { "name": "convert", "properties": "price", "type": "real" },
        { "name": "insert", "value": "Commerce impression" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-product-detail",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.detail.products" },
        { "name": "fan-out" },
        { "name": "convert", "properties": "price", "type": "real" },
        { "name": "insert", "value": "Commerce product detail" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-product-click",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.click.products" },
        { "name": "fan-out" },
        { "name": "convert", "properties": "price", "type": "real" },
        { "name": "insert", "value": "Commerce product click" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-cart-add",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.add.products" },
        { "name": "fan-out" },
        { "name": "convert", "properties": "price", "type": "real" },
        { "name": "insert", "value": "Commerce cart add" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-cart-remove",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.remove.products" },
        { "name": "fan-out" },
        { "name": "convert", "properties": "price", "type": "real" },
        { "name": "insert", "value": "Commerce cart remove" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-promotion-impressions",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.promoView.promotions" },
        { "name": "fan-out" },
        { "name": "insert", "value": "Commerce promotion impression" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-promotion-clicks",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.promoClick.promotions" },
        { "name": "fan-out" },
        { "name": "insert", "value": "Commerce promotion click" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-checkout",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.checkout.actionField" },
        { "name": "insert", "value": "Commerce checkout" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-purchase",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.purchase.actionField" },
        { "name": "convert", "properties": "revenue,tax,shipping", "type": "real" },
        { "name": "insert", "value": "Commerce purchase" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-e-commerce-refund",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$.ecommerce.refund.actionField" },
        { "name": "insert", "value": "Commerce refund" }
      ],
      "destination": "FS.event",
      "readOnLoad": true,
      "monitor": true
    },
    {
      "id": "fs-ga-user-vars",
      "source": "dataLayer",
      "operators": [
        { "name": "query", "select": "$[?(userProfile)]" },
        { "name": "flatten"},
        { "name": "query", "select": "$[?(userId!=-1)]" },
        { "name": "insert", "select": "userId" }
      ],
      "destination": "FS.setUserVars",
      "readOnLoad": true,
      "monitor": true
    }
      ];
    </script>
    <script async="true" src="../../build/dlo.js"></script>
  </body>
</html>
